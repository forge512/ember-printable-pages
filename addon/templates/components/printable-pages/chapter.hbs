{{#each this.pages as |page pageIndexInChapter|}}
  {{#printable-pages/page-layout pageLayout=pageLayout}}
    {{#printable-pages/chapter-page
      pageIndexInChapter=pageIndexInChapter
      pageMeta=(hash
        current=(add this.startPage pageIndexInChapter)
        chapterNumber=(inc this.chapter.index)
        total=lastReportPage
        isFirst=(eq page.number 1)
        isFirstInChapter=(eq page.number this.startPage)
        isLast=(eq page.number lastReportPage)
        isLastInChapter=(eq page.number this.endPage)
      )

      registerSection=(action this.registerSection this.elementId)
      renderNextItem=(action "renderNextItem" pageIndexInChapter)
      onPageOverflow=(action "onPageOverflow" pageIndexInChapter)
      as |pageComponent|
    }}
      {{#if (eq pageComponent.block "header")}}
        {{yield (hash
          page-header=(component "printable-pages/page-header" pageMeta=pageComponent.meta)
          section=(component "printable-pages/section" shouldRender=false)
          page-footer=(component "printable-pages/page-footer" shouldRender=false)
        )}}
      {{/if}}

      {{#if (eq pageComponent.block "body")}}
        {{yield (hash
          number=pageComponent.meta

          page-header=(component "printable-pages/page-header" shouldRender=false)
          page-footer=(component "printable-pages/page-footer" shouldRender=false)

          section=(component "printable-pages/section"
            sectionMap=this.chapter.sectionMap
            pageIndexInChapter=pageIndexInChapter
            pageElement=pageComponent.element

            register=(action pageComponent.registerSection)
            onSectionOverflow=pageComponent.onSectionOverflow
          )
        )}}
      {{/if}}

      {{#if (eq pageComponent.block "footer")}}
        {{yield (hash
          page-header=(component "printable-pages/page-header" shouldRender=false)
          section=(component "printable-pages/section" shouldRender=false)
          page-footer=(component "printable-pages/page-footer" pageMeta=pageComponent.meta)
        )}}
      {{/if}}
    {{/printable-pages/chapter-page}}
  {{/printable-pages/page-layout}}
{{/each}}
