<div
  class="PrintablePages-chapter"
  id={{this.elementId}}
  data-test-chapter={{this.chapter.index}}
  {{did-insert this.onInsert this}}
>
  {{#each this.pages as |page pageIndexInChapter|}}
    {{#let (add this.startPage pageIndexInChapter) as |pageNumber|}}
      <PrintablePages::PageLayout
        @pageLayout={{@pageLayout}}
        @pageNumber={{pageNumber}}
      >
        <PrintablePages::ChapterPage
          @pageIndexInChapter={{pageIndexInChapter}}
          @pageMeta={{hash
            current=pageNumber
            pageNumber=pageNumber
            chapterNumber=(inc this.chapter.index)
            total=@lastReportPage
            isFirst=(eq pageNumber 1)
            isFirstInChapter=(eq pageNumber this.startPage)
            isLast=(eq pageNumber @lastReportPage)
            isLastInChapter=(eq pageNumber this.endPage)
          }}
          @registerSection={{fn @registerSection this.elementId}}
          @renderNextItem={{fn this.renderNextItem pageIndexInChapter}}
          @onPageOverflow={{fn this.onPageOverflow pageIndexInChapter}}
          @renderNextPage={{fn this.renderNextPage pageIndexInChapter}}
          as |pageComponent|
        >
          {{#if (eq pageComponent.block "header")}}
            {{yield
              (hash
                page-header=(component
                  "printable-pages/page-header" pageMeta=pageComponent.meta
                )
              )
            }}
          {{/if}}

          {{#if (eq pageComponent.block "body")}}
            {{yield
              (hash
                number=pageComponent.meta
                section=(component
                  "printable-pages/section"
                  sectionMap=this.chapter.sectionMap
                  pageIndexInChapter=pageIndexInChapter
                  pageElement=pageComponent.element
                  register=pageComponent.registerSection
                  registerSection=pageComponent.registerSection
                  onSectionOverflow=pageComponent.onSectionOverflow
                  triggerRerender=@triggerRerender
                  setLastRenderedItem=pageComponent.setLastRenderedItem
                )
              )
            }}
          {{/if}}

          {{#if (eq pageComponent.block "footer")}}
            {{yield
              (hash
                page-footer=(component
                  "printable-pages/page-footer" pageMeta=pageComponent.meta
                )
              )
            }}
          {{/if}}
        </PrintablePages::ChapterPage>
      </PrintablePages::PageLayout>
    {{/let}}
  {{/each}}
</div>